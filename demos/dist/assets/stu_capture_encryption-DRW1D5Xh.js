import{c as T}from"./stu-sdk.min-DAnsK4yV.js";var a={bitArray:{bitLength:function(e){var t=e.length,r;return t===0?0:(r=e[t-1],(t-1)*32+a.bitArray.getPartial(r))},clamp:function(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t=t&31,r>0&&t&&(e[r-1]=a.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return e===32?t:(r?t|0:t<<32-e)+e*1099511627776},getPartial:function(e){return Math.round(e/1099511627776)||32}},Codec:{Hex:{fromBits:function(e){var t="",r;for(r=0;r<e.length;r++)t+=((e[r]|0)+0xf00000000000).toString(16).substr(4);return t.substr(0,a.bitArray.bitLength(e)/4)},toBits:function(e){var t,r=[],i;for(e=e.replace(/\s|0x/g,""),i=e.length,e=e+"00000000",t=0;t<e.length;t+=8)r.push(parseInt(e.substr(t,8),16)^0);return a.bitArray.clamp(r,i*4)}},strToWords:function(e){if(e.constructor!==String)throw"Input must be a string.";for(var t=unescape(encodeURIComponent(e)),r=t.length,i=[],n=0,o=0;o<r;o++)n=n<<8|t.charCodeAt(o),(o&3)===3&&(i.push(n),n=0);return o&3&&i.push(this.encodePartial(8*(o&3),n)),i},wordsToStr:function(e){if(e.constructor!==Array)throw"Input must be an array.";for(var t=this.bitLength(e),r="",i,n=0;n<t/8;n++)n&3||(i=e[n/4]),r+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(r))},encodePartial:function(e,t,r){return e===32?t:(r?t|0:t<<32-e)+e*1099511627776},getPartial:function(e){return Math.round(e/1099511627776)||32},bitLength:function(e){var t=e.length,r;return t===0?0:(r=e[t-1],(t-1)*32+this.getPartial(r))}},ECB:function(e){this._tables[0][0][0]||this._precompute();var t,r,i,n,o,c=this._tables[0][4],g=this._tables[1],u=e.length,p=1;if(u!==4&&u!==6&&u!==8)throw"Invalid AES key size.";for(this._key=[n=e.slice(0),o=[]],t=u;t<4*u+28;t++)i=n[t-1],(t%u===0||u===8&&t%u===4)&&(i=c[i>>>24]<<24^c[i>>16&255]<<16^c[i>>8&255]<<8^c[i&255],t%u===0&&(i=i<<8^i>>>24^p<<24,p=p<<1^(p>>7)*283)),n[t]=n[t-u]^i;for(r=0;t;r++,t--)i=n[r&3?t:t-4],t<=4||r<4?o[r]=i:o[r]=g[0][c[i>>>24]]^g[1][c[i>>16&255]]^g[2][c[i>>8&255]]^g[3][c[i&255]];this.encrypt=function(y){return this._crypt(y,0)},this.decrypt=function(y){return this._crypt(y,1)},this._crypt=function(y,f){if(y.length!==4)throw"Invalid AES block size.";var s=this._key[f],h=y[0]^s[0],l=y[f?3:1]^s[1],x=y[2]^s[2],b=y[f?1:3]^s[3],v,H,k,M=s.length/4-2,d,A=4,U=[0,0,0,0],S=this._tables[f],_=S[0],B=S[1],I=S[2],K=S[3],C=S[4];for(d=0;d<M;d++)v=_[h>>>24]^B[l>>16&255]^I[x>>8&255]^K[b&255]^s[A],H=_[l>>>24]^B[x>>16&255]^I[b>>8&255]^K[h&255]^s[A+1],k=_[x>>>24]^B[b>>16&255]^I[h>>8&255]^K[l&255]^s[A+2],b=_[b>>>24]^B[h>>16&255]^I[l>>8&255]^K[x&255]^s[A+3],A+=4,h=v,l=H,x=k;for(d=0;d<4;d++)U[f?3&-d:d]=C[h>>>24]<<24^C[l>>16&255]<<16^C[x>>8&255]<<8^C[b&255]^s[A++],v=h,h=l,l=x,x=b,b=v;return U}}};a.ECB.prototype._precompute=function(){var e=this._tables[0],t=this._tables[1],r=e[4],i=t[4],n,o,c,g=[],u=[],p,y,f,s,h,l;for(n=0;n<256;n++)u[(g[n]=n<<1^(n>>7)*283)^n]=n;for(o=c=0;!r[o];o^=p||1,c=u[c]||1)for(s=c^c<<1^c<<2^c<<3^c<<4,s=s>>8^s&255^99,r[o]=s,i[s]=o,f=g[y=g[p=g[o]]],l=f*16843009^y*65537^p*257^o*16843008,h=g[s]*257^s*16843008,n=0;n<4;n++)e[n][o]=h=h<<24^h>>>8,t[n][s]=l=l<<24^l>>>8;for(n=0;n<5;n++)e[n]=e[n].slice(0),t[n]=t[n].slice(0)};a.ECB.prototype._tables=[[[],[],[],[],[]],[[],[],[],[],[]]];function R(e,t){var r=e.toString(16);return"0000000000000000".substr(0,t-r.length)+r}function D(e){return R(e,2)}function m(e){for(var t="",r=0;r<e.length;++r)t=t+D(e[r]);return t}function E(e){for(var t=new Array,r=0;r<e.length;r+=2)t.push(parseInt("0x"+e.substr(r,2),16));return t}function P(e,t,r){return e=e.toString(),t>e.length&&(e=Array(t+1-e.length).join(r)+e),e}function L(e){e=atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var t=new Array(e.length),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}function w(e,t,r){return t<=BigInt(0)?BigInt(1):t===BigInt(1)?e%r:t%BigInt(2)===BigInt(0)?w(e*e%r,t/BigInt(2)|BigInt(0),r)%r:w(e*e%r,t/BigInt(2)|BigInt(0),r)*e%r}class j{constructor(){this.clearKeys()}reset(){this.clearKeys()}clearKeys(){this.bigint_p=null,this.bigint_g=null,this.aesCipher=null}requireDH(){return this.bigint_p==null||this.bigint_g==null}setDH(t,r){var i=t,n=r;this.bigint_p=BigInt("0x"+m(i)),this.bigint_g=BigInt("0x"+m(n))}generateHostPublicKey(){let t=new Uint8Array(64);window.crypto.getRandomValues(t),this.bigint_a=BigInt("0x"+m(t));var r=w(this.bigint_g,this.bigint_a,this.bigint_p),i=P(r.toString(16),32,"0"),n=E(i);return n}computeSharedKey(t){const i=BigInt("0x"+m(t)),n=w(i,this.bigint_a,this.bigint_p),o=P(n.toString(16),32,"0"),c=a.Codec.Hex.toBits(o);this.aesCipher=new a.ECB(c)}decrypt(t){const r=m(t),i=a.Codec.Hex.toBits(r),n=this.aesCipher.decrypt(i),o=a.Codec.Hex.fromBits(n);return E(o)}}class G{constructor(){this.clearKeys()}reset(){this.clearKeys()}clearKeys(){this.privateKey=null,this.keyAES=null,this.exponent=null,this.modulus=null}getSymmetricKeyType(){return T.WacomGSS.STU.Protocol.SymmetricKeyType.AES256}getAsymmetricPaddingType(){return T.WacomGSS.STU.Protocol.AsymmetricPaddingType.OAEP}getAsymmetricKeyType(){return T.WacomGSS.STU.Protocol.AsymmetricKeyType.RSA2048}async getPublicExponent(){const t=await window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},!0,["encrypt","decrypt"]);this.privateKey=t.privateKey;const r=await window.crypto.subtle.exportKey("jwk",t.publicKey);return this.modulus=L(r.n),this.exponent=L(r.e),this.exponent}async generatePublicKey(){return this.modulus}async computeSessionKey(t){const r=await window.crypto.subtle.decrypt({name:"RSA-OAEP"},this.privateKey,Uint8Array.from(t)),i=BigInt("0x"+m(new Uint8Array(r))),n=P(i.toString(16),64,"0"),o=a.Codec.Hex.toBits(n);this.aesCipher=new a.ECB(o)}decrypt(t){const r=m(t),i=a.Codec.Hex.toBits(r),n=this.aesCipher.decrypt(i),o=a.Codec.Hex.fromBits(n);return E(o)}}export{j as M,G as a};

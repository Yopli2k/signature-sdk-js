var k=y=>{throw TypeError(y)};var G=(y,t,e)=>t.has(y)||k("Cannot "+e);var P=(y,t,e)=>t.has(y)?k("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(y):t.set(y,e);var b=(y,t,e)=>(G(y,t,"access private method"),e);import{g as K,c as w}from"./stu-sdk.min-DAnsK4yV.js";function N(){this.Bounds,this.Text,this.Click}function V(y,t,e,i){this.x=y,this.y=t,this.width=e,this.height=i,this.Contains=function(n){return n.x>=this.x&&n.x<=this.x+this.width&&n.y>=this.y&&n.y<=this.y+this.height}}function x(y){var t={evaluation:"Evaluierung",ok:"OK",cancel:"Abbrechen",clear:"Löschen",defaultName:"Kunde",defaultReason:"Bestätigt"},e={evaluation:"Αξιολόγηση",ok:"Εντάξει",cancel:"Ακύρωση",clear:"Διαγραφή",defaultName:"Πελάτης",defaultReason:"Επιβεβαιωμένος"},i={evaluation:"Evaluation",ok:"OK",cancel:"Cancel",clear:"Clear",defaultName:"Customer",defaultReason:"Confirmed"},n={evaluation:"Evaluación",ok:"Aceptar",cancel:"Cancelar",clear:"Borrar",defaultName:"Cliente",defaultReason:"Confirmado"},s={evaluation:"Évaluation",ok:"OK",cancel:"Annuler",clear:"Effacer",defaultName:"Client",defaultReason:"Confirmé"},r={evaluation:"Valutazione",ok:"OK",cancel:"Annulla",clear:"Cancella",defaultName:"Utente",defaultReason:"Confermato"},o={evaluation:"評価",ok:"OK",cancel:"キャンセル",clear:"クリア",defaultName:"署名者",defaultReason:"確認済"},a={evaluation:"평가",ok:"확인",cancel:"취소",clear:"지우기",defaultName:"고객",defaultReason:"확인됨"},h={evaluation:"Evaluatie",ok:"OK",cancel:"Annuleren",clear:"Verwijderen",defaultName:"Klant",defaultReason:"Bevestigd"},d={evaluation:"Ocena",ok:"OK",cancel:"Anuluj",clear:"Wyczyść",defaultName:"Klient",defaultReason:"Potwierdzono"},m={evaluation:"Avaliação",ok:"OK",cancel:"Cancelar",clear:"Apagar",defaultName:"Cliente",defaultReason:"Confirmado"},l={evaluation:"Оценка",ok:"OK",cancel:"Отмена",clear:"Удалить",defaultName:"Клиент",defaultReason:"Подтверждено"},g={evaluation:"评估",ok:"确定",cancel:"取消",clear:"清除",defaultName:"顾客",defaultReason:"确认"},c={de:t,el:e,en:i,es:n,fr:s,it:r,ja:o,ko:a,nl:h,pl:d,pt:m,ru:l,zh:g},f=(navigator.language||navigator.userLanguage||"en-GB").split("-")[0];let p=c[f];return p||(p=c.en),p[y]}function T(y){let t=0,e=0,i=0;if(y instanceof PointerEvent){if(event.altitudeAngle!==void 0&&event.azimuthAngle!==void 0)t=event.altitudeAngle,e=event.azimuthAngle;else if(event.tiltX!==void 0&&event.tilY!==void 0){let s=n(event.tiltX,event.tiltY);t=s.altitudeAngle,e=s.azimuthAngle}return{altitude:t,azimuth:e,twist:event.twist}}else{const s=y.touches?y.touches[0]:null;return s&&(s.altitudeAngle&&(t=s.altitudeAngle),s.azimuthAngle&&(e=s.azimuthAngle),s.rotationAngle&&(i=s.rotationAngle)),{altitude:t,azimuth:e,twist:i}}function n(s,r){const o=s*Math.PI/180,a=r*Math.PI/180;let h=0;if(s==0)r>0?h=Math.PI/2:r<0&&(h=3*Math.PI/2);else if(r==0)s<0&&(h=Math.PI);else if(Math.abs(s)==90||Math.abs(r)==90)h=0;else{const m=Math.tan(o),l=Math.tan(a);h=Math.atan2(l,m),h<0&&(h+=2*Math.PI)}let d=0;return Math.abs(s)==90||Math.abs(r)==90?d=0:s==0?d=Math.PI/2-Math.abs(a):r==0?d=Math.PI/2-Math.abs(o):d=Math.atan(1/Math.sqrt(Math.pow(Math.tan(o),2)+Math.pow(Math.tan(a),2))),{altitudeAngle:d,azimuthAngle:h}}}var u,I,E,M,L,B,W,O,z,A,_,F,Y,U,R,X,H;class j{constructor(t,e){P(this,u);this.sigSDK=t,this.config={width:400,height:300,left:0,top:0,centered:!0,title:"My Tittle",borderColor:"#0097d4",borderWidth:"1p",hasTitle:!0,buttons:[{text:"*clear",textColor:"black",backgroundColor:"lightgrey",borderWidth:0,borderColor:"black",onClick:this.btnClearClick.bind(this)},{text:"*cancel",textColor:"black",backgroundColor:"lightgrey",borderWidth:0,borderColor:"black",onClick:this.btnCancelClick.bind(this)},{text:"*ok",textColor:"black",backgroundColor:"lightgrey",borderWidth:0,borderColor:"black",onClick:this.btnOkClick.bind(this)}],buttonsFont:"Arial",background:{alpha:1,color:"white",mode:"fit"},reason:{visible:!0,fontFace:"Arial",fontSize:16,color:"black",offsetY:10,offsetX:5},signatory:{visible:!0,fontFace:"Arial",fontSize:16,color:"black",offsetY:5,offsetX:30},date:{visible:!0,fontFace:"Arial",fontSize:16,color:"black",offsetY:20,offsetX:30},signingLine:{visible:!0,left:30,right:30,width:2,color:"grey",offsetY:5},source:{mouse:!0,touch:!0,pen:!0,stu:!0},strokeColor:"#0202FE",strokeSize:6,modal:!0,draggable:!0,timeOut:{enabled:!1,time:1e4,onTimeOut:null},allowZeroPressure:!0},e&&this.mapConfig(e),this.capturedPoints=new Array,this.onClearListeners=new Array,this.onCancelListeners=new Array,this.onOkListeners=new Array,this.timeOnSurface=0,K().then(i=>{this.webBrowserData=i})}mapConfig(t){t.width&&(this.config.width=t.width),t.height&&(this.config.height=t.height),t.left!=null&&(this.config.left=t.left),t.top!=null&&(this.config.top=t.top),t.centered!=null&&(this.config.centered=t.centered),t.title&&(this.config.title=t.title),t.hasTitle!=null&&(this.config.hasTitle=t.hasTitle),t.borderWidth!=null&&(this.config.borderWidth=t.borderWidth),t.borderColor&&(this.config.borderColor=t.borderColor),t.buttonsFont&&(this.config.buttonsFont=t.buttonsFont),t.background&&(t.background.alpha&&(this.config.background.alpha=t.background.alpha),t.background.color&&(this.config.background.color=t.background.color),t.background.image&&(this.config.background.image=t.background.image),t.background.mode&&(this.config.background.mode=t.background.mode)),t.reason&&(t.reason.visible!=null&&(this.config.reason.visible=t.reason.visible),t.reason.fontFace&&(this.config.reason.fontFace=t.reason.fontFace),t.reason.fontSize&&(this.config.reason.fontSize=t.reason.fontSize),t.reason.color&&(this.config.reason.color=t.reason.color),t.reason.offsetY&&(this.config.reason.offsetY=t.reason.offsetY),t.reason.offsetX&&(this.config.reason.offsetX=t.reason.offsetX)),t.signatory&&(t.signatory.visible!=null&&(this.config.signatory.visible=t.signatory.visible),t.signatory.fontFace&&(this.config.signatory.fontFace=t.signatory.fontFace),t.signatory.fontSize&&(this.config.signatory.fontSize=t.signatory.fontSize),t.signatory.color&&(this.config.signatory.color=t.signatory.color),t.signatory.offsetY&&(this.config.signatory.offsetY=t.signatory.offsetY),t.signatory.offsetX&&(this.config.signatory.offsetX=t.signatory.offsetX)),t.signingLine&&(t.signingLine.visible!=null&&(this.config.signingLine.visible=t.signingLine.visible),t.signingLine.left&&(this.config.signingLine.left=t.signingLine.left),t.signingLine.right&&(this.config.signingLine.right=t.signingLine.right),t.signingLine.width&&(this.config.signingLine.width=t.signingLine.width),t.signingLine.color&&(this.config.signingLine.color=t.signingLine.color),t.signingLine.offsetY&&(this.config.signingLine.offsetY=t.signingLine.offsetY)),t.date&&(t.date.visible!=null&&(this.config.date.visible=t.date.visible),t.date.fontFace&&(this.config.date.fontFace=t.date.fontFace),t.date.fontSize&&(this.config.date.fontSize=t.date.fontSize),t.date.left&&(this.config.date.left=t.date.left),t.date.right&&(this.config.date.right=t.date.right),t.date.width&&(this.config.date.width=t.date.width),t.date.color&&(this.config.date.color=t.date.color),t.date.offsetY&&(this.config.date.offsetY=t.date.offsetY)),t.attachTo&&(this.config.attachTo=t.attachTo),t.modal!=null&&(this.config.modal=t.modal),t.draggable!=null&&(this.config.draggable=t.draggable),t.source&&(t.source.mouse!=null&&(this.config.source.mouse=t.source.mouse),t.source.touch!=null&&(this.config.source.touch=t.source.touch),t.source.pen!=null&&(this.config.source.pen=t.source.pen),t.source.stu!=null&&(this.config.source.stu=t.source.stu)),t.strokeColor!=null&&(this.config.strokeColor=t.strokeColor),t.strokeSize!=null&&(this.config.strokeSize=t.strokeSize),t.buttons&&(this.config.buttons=t.buttons),t.timeOut&&(this.config.timeOut=t.timeOut),t.minTimeOnSurface&&(this.config.minTimeOnSurface=t.minTimeOnSurface),t.onOutSide&&(this.config.onOutSide=t.onOutSide),t.allowZeroPressure!=null&&(this.config.allowZeroPressure=t.allowZeroPressure)}addEventListener(t,e){switch(t){case"clear":this.onClearListeners.push(e);break;case"cancel":this.onCancelListeners.push(e);break;case"ok":this.onOkListeners.push(e);break}}async open(t,e,i,n,s,r){this.sigObj=t,this.extraData=n,e?this.signatory=e:this.signatory=x("defaultName"),i?this.reason=i:this.reason=x("defaultReason"),s?this.integrityType=s:this.integrityType=this.sigSDK.KeyType.None,r?this.documentHash=r:this.documentHash=new this.sigSDK.Hash(this.sigSDK.HashType.None),this.createWindow(parseInt(this.config.width),parseInt(this.config.height)),this.drawingCtx=this.drawingCanvas.getContext("2d"),this.drawingCtx.fillStyle=this.config.strokeColor,this.drawingCtx.strokeStyle=this.config.strokeColor,this.drawingCtx.lineJoin="round";const o=window.devicePixelRatio||1;if(this.drawingCtx.scale(o,o),this.drawingPath=new Path2D,this.mBtns=new Array(this.config.buttons.length),this.config.buttons.length>0){const m=this.canvas.height*6/7,l=this.canvas.height-m,g=this.canvas.width/this.config.buttons.length;for(var a=0;a<this.config.buttons.length;a++){this.mBtns[a]=new N,this.mBtns[a].Bounds=new V(a*g,m,g,l);let c;this.config.buttons[a].text.startsWith("*")?c=x(this.config.buttons[a].text.substr(1)):c=this.config.buttons[a].text,this.mBtns[a].Text=c,this.mBtns[a].Click=this.config.buttons[a].onClick}}this.ctx.lineWidth=1,this.ctx.strokeStyle="black",this.ctx.font="30px Arial",this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.canvasBackgroundImage=this.createScreenImage(!0);const h=this,d=new Image;d.onload=function(){h.ctx.drawImage(d,0,0)},d.src=this.canvasBackgroundImage}startCapture(){this.isCapturing||("ontouchstart"in document.documentElement?(this.touchStartID=b(this,u,I).bind(this),this.mouseDownID=b(this,u,E).bind(this),this.touchMoveID=b(this,u,M).bind(this),this.mouseMoveID=b(this,u,L).bind(this),this.touchEndID=b(this,u,B).bind(this),this.mouseUpID=b(this,u,W).bind(this),this.touchCancelID=b(this,u,O).bind(this),this.drawingCanvas.addEventListener("touchstart",this.touchStartID),this.drawingCanvas.addEventListener("mousedown",this.mouseDownID),this.drawingCanvas.addEventListener("touchmove",this.touchMoveID),this.drawingCanvas.addEventListener("mousemove",this.mouseMoveID),this.drawingCanvas.addEventListener("touchend",this.touchEndID),this.drawingCanvas.addEventListener("mouseup",this.mouseUpID),this.drawingCanvas.addEventListener("touchcancel",this.touchCancelID)):(this.pointerDownID=b(this,u,z).bind(this),this.pointerMoveID=b(this,u,A).bind(this),this.pointerUpID=b(this,u,_).bind(this),this.pointerCancelID=b(this,u,F).bind(this),this.pointerLeaveID=b(this,u,X).bind(this),this.pointerEnterID=b(this,u,H).bind(this),this.drawingCanvas.addEventListener("pointerdown",this.pointerDownID),this.drawingCanvas.addEventListener("pointermove",this.pointerMoveID),this.drawingCanvas.addEventListener("pointerup",this.pointerUpID),this.drawingCanvas.addEventListener("pointercancel",this.pointerCancelID),this.drawingCanvas.addEventListener("pointerleave",this.pointerLeaveID),this.drawingCanvas.addEventListener("pointerenter",this.pointerEnterID)),this.mouseLeaveID=b(this,u,Y).bind(this),this.mouseEnterID=b(this,u,U).bind(this),this.contextMenuID=b(this,u,R).bind(this),this.drawingCanvas.addEventListener("mouseleave",this.mouseLeaveID),this.drawingCanvas.addEventListener("mouseenter",this.mouseEnterID),document.addEventListener("contextmenu",this.contextMenuID),this.isCapturing=!0,this.showLoadingScreen(!1),this.startTimeOut())}stopCapture(){"ontouchstart"in document.documentElement?(this.drawingCanvas.removeEventListener("touchstart",this.touchStartID),this.drawingCanvas.removeEventListener("mousedown",this.mouseDownID),this.drawingCanvas.removeEventListener("touchmove",this.touchMoveID),this.drawingCanvas.removeEventListener("mousemove",this.mouseMoveID),this.drawingCanvas.removeEventListener("touchend",this.touchEndID),this.drawingCanvas.removeEventListener("mouseup",this.mouseUpID),this.drawingCanvas.removeEventListener("touchcancel",this.touchCancelID)):(this.drawingCanvas.removeEventListener("pointerdown",this.pointerDownID),this.drawingCanvas.removeEventListener("pointermove",this.pointerMoveID),this.drawingCanvas.removeEventListener("pointerup",this.pointerUpID),this.drawingCanvas.removeEventListener("pointercancel",this.pointerCancelID),this.drawingCanvas.removeEventListener("pointerleave",this.pointerLeaveID),this.drawingCanvas.removeEventListener("pointerenter",this.pointerEnterID)),this.drawingCanvas.removeEventListener("mouseleave",this.mouseLeaveID),this.drawingCanvas.removeEventListener("mouseenter",this.mouseEnterID),document.removeEventListener("contextmenu",this.contextMenuID),this.isCapturing=!1,this.showLoadingScreen(!0),this.stopTimeOut()}async close(){await this.closeWindow()}getBackgroundScreen(){return this.canvasBackgroundImage}getButton(t){for(var e=0;e<this.mBtns.length;++e)if(this.mBtns[e].Bounds.Contains(t))return e;return-1}clickButton(t){this.mBtns.length>t&&this.mBtns[t].Click()}showLoadingScreen(t){t?this.mLoadingImageDiv.style.display="table":this.mLoadingImageDiv.style.display="none"}showGeneratingSignatureScreen(t){t?this.mGeneratingSignatureDiv.style.display="table":this.mGeneratingSignatureDiv.style.display="none"}createWindow(t,e){if(this.config.modal&&(this.mModalBackground=document.createElement("div"),this.mModalBackground.id="modal-background",this.mModalBackground.className="active",this.mModalBackground.style.width="100%",this.mModalBackground.style.height="100%",this.mModalBackground.style.position="fixed",document.getElementsByTagName("body")[0].appendChild(this.mModalBackground)),this.config.attachTo){const i=document.getElementById(this.config.attachTo);i.getBoundingClientRect(),this.mSignatureWindow=document.createElement("div"),this.mSignatureWindow.setAttribute("style","touch-action: none;z-index: 1001;"),this.mSignatureWindow.id="signatureWindow",this.mSignatureWindow.style.top=0,this.mSignatureWindow.style.left=0,this.mSignatureWindow.style.width="100%",this.mSignatureWindow.style.height="100%",i.appendChild(this.mSignatureWindow),this.mFormDiv=document.createElement("div"),this.mFormDiv.setAttribute("style","touch-action: none;z-index: 1001;"),this.mFormDiv.style.position="absolute",this.mFormDiv.style.width=t+"px",this.mFormDiv.style.height=e+"px",this.mSignatureWindow.appendChild(this.mFormDiv),this.canvas=document.createElement("canvas"),this.canvas.id="myCanvas",this.canvas.style.position="absolute",this.canvas.height=this.mFormDiv.offsetHeight,this.canvas.width=this.mFormDiv.offsetWidth,this.canvas.style.opacity=this.config.background.alpha,this.ctx=this.canvas.getContext("2d"),this.mFormDiv.appendChild(this.canvas),this.drawingCanvas=document.createElement("canvas"),this.drawingCanvas.id="drawingCanvas",this.drawingCanvas.style.position="absolute",this.drawingCanvas.style.top=this.canvas.style.top,this.drawingCanvas.style.left=this.canvas.style.left;const n=window.devicePixelRatio||1;this.drawingCanvas.height=this.canvas.height*n,this.drawingCanvas.width=this.canvas.width*n,this.drawingCanvas.style.width=this.canvas.width+"px",this.drawingCanvas.style.height=this.canvas.height+"px",this.mFormDiv.appendChild(this.drawingCanvas)}else{let i=this.config.hasTitle?25:0,n=0;this.mSignatureWindow=document.createElement("div"),this.mSignatureWindow.setAttribute("style","touch-action: none;z-index: 1001;"),this.mSignatureWindow.id="signatureWindow",this.mSignatureWindow.style.position="absolute",this.mSignatureWindow.style.borderWidth=this.config.borderWidth+"px",this.mSignatureWindow.style.borderStyle="solid",this.mSignatureWindow.style.borderColor=this.config.borderColor,this.config.centered?(this.mSignatureWindow.style.top=window.innerHeight/2-e/2+"px",this.mSignatureWindow.style.left=window.innerWidth/2-t/2+"px"):(this.mSignatureWindow.style.top=this.config.top,this.mSignatureWindow.style.left=this.config.left),this.mSignatureWindow.style.width=t+n+n+"px",this.mSignatureWindow.style.height=e+i+n+n+"px",document.getElementsByTagName("body")[0].appendChild(this.mSignatureWindow),this.config.hasTitle&&(this.mTitleBar=document.createElement("div"),this.mTitleBar.id="titleBar",this.mTitleBar.setAttribute("style","display:table;padding:0;margin:0"),this.mTitleBar.style.width="100%",this.mTitleBar.style.height=i+"px",this.mTitleBar.style.backgroundColor=this.config.borderColor,this.mTitleBar.innerHTML='<div style="padding-left:5px;display: table-cell; vertical-align: middle;height:'+i+'px;">'+this.config.title+"</div>",this.mSignatureWindow.appendChild(this.mTitleBar)),this.mFormDiv=document.createElement("div"),this.mFormDiv.style.position="absolute",this.mFormDiv.style.margin="0",this.mFormDiv.style.top=i,this.mFormDiv.style.width=t+"px",this.mFormDiv.style.height=e+"px",this.mSignatureWindow.appendChild(this.mFormDiv),this.canvas=document.createElement("canvas"),this.canvas.id="myCanvas",this.canvas.style.position="absolute",this.canvas.height=this.mFormDiv.offsetHeight,this.canvas.width=this.mFormDiv.offsetWidth,this.canvas.style.opacity=this.config.background.alpha,this.ctx=this.canvas.getContext("2d"),this.mFormDiv.appendChild(this.canvas),this.drawingCanvas=document.createElement("canvas"),this.drawingCanvas.id="drawingCanvas",this.drawingCanvas.style.position="absolute",this.drawingCanvas.style.top=this.canvas.style.top,this.drawingCanvas.style.left=this.canvas.style.left;const s=window.devicePixelRatio||1;this.drawingCanvas.height=this.canvas.height*s,this.drawingCanvas.width=this.canvas.width*s,this.drawingCanvas.style.width=this.canvas.width+"px",this.drawingCanvas.style.height=this.canvas.height+"px",this.mFormDiv.appendChild(this.drawingCanvas),this.config.draggable&&this.setDraggable()}this.mLoadingImageDiv=document.createElement("div"),this.mLoadingImageDiv.style.display="table",this.mLoadingImageDiv.style.position="absolute",this.mLoadingImageDiv.style.backgroundColor="white",this.mLoadingImageDiv.style.width="100%",this.mLoadingImageDiv.style.height="100%",this.mLoadingImageDiv.innerHTML='<div id="loadingDiv" style="padding-left:10px;display:table-cell;vertical-align:middle;"><table><tr><td><div class="loader"></div></td><td>Loading the image, this could take a few seconds...</td></tr></table></div>',this.mFormDiv.appendChild(this.mLoadingImageDiv),this.mGeneratingSignatureDiv=document.createElement("div"),this.mGeneratingSignatureDiv.style.display="none",this.mGeneratingSignatureDiv.style.position="absolute",this.mGeneratingSignatureDiv.style.backgroundColor="white",this.mGeneratingSignatureDiv.style.width="100%",this.mGeneratingSignatureDiv.style.height="100%",this.mGeneratingSignatureDiv.style.zIndex="10",this.mGeneratingSignatureDiv.innerHTML='<div id="generatingDiv" style="padding-left:10px;display:table-cell;vertical-align:middle;z-index:9"><table><tr><td><div class="loader"></div></td><td>Generating the signature, this could take a few seconds...</td></tr></table></div>',this.mFormDiv.appendChild(this.mGeneratingSignatureDiv)}createScreenImage(t){let e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;let i=e.getContext("2d");if(i.lineWidth=1,i.strokeStyle="black",i.fillStyle=t?this.config.background.color:"#ffffff",i.fillRect(0,0,this.canvas.width,this.canvas.height),this.config.background.image){if(this.config.background.mode=="none")i.drawImage(this.config.background.image,0,0);else if(this.config.background.mode=="fit")i.drawImage(this.config.background.image,0,0,e.width,e.height);else if(this.config.background.mode=="center")i.drawImage(this.config.background.image,e.width/2-this.config.background.image.width/2,e.height/2-this.config.background.image.height/2);else if(this.config.background.mode=="pattern"){const l=i.createPattern(this.config.background.image,"repeat");i.fillStyle=l,i.fillRect(0,0,this.canvas.width,this.canvas.height)}}let n=Number.MAX_SAFE_INTEGER;for(let l=0;l<this.mBtns.length;l++){let g=this.mBtns[l],c=this.mBtns[l].Bounds,f=this.fitTextOnCanvas(i,g.Text,c,this.config.buttonsFont);f<n&&(n=f)}i.font=n+"px "+this.config.buttonsFont;let s=0;for(let l=0;l<this.mBtns.length;++l){let g=this.mBtns[l],c=this.mBtns[l].Bounds;i.fillStyle=t?this.config.buttons[l].borderColor:"#000000",i.rect(c.x,c.y,c.width,c.height),i.fillStyle=t?this.config.buttons[l].backgroundColor:"#ffffff",i.fillRect(c.x,c.y,c.width,c.height);let f=i.measureText(g.Text),p=f.actualBoundingBoxAscent+f.actualBoundingBoxDescent,D=c.x+(c.width/2-i.measureText(g.Text).width/2),S=c.height-(c.height/2-p/2);i.fillStyle=t?this.config.buttons[l].textColor:"#000000",i.fillText(g.Text,D,c.y+S),s=c.height;const v=document.createElement("button");v.setAttribute("style","position:absolute;padding:0;margin:0;"),v.innerHTML='<div style="line-height:'+S+'px">'+g.Text+"</div>",v.style.left=c.x+"px",v.style.top=c.y+"px",v.style.width=c.width+"px",v.style.height=c.height+"px",v.style.font=n+"px "+this.config.buttonsFont,v.style.color=this.config.buttons[l].textColor,v.style.backgroundColor=this.config.buttons[l].backgroundColor,v.style.border=this.config.buttons[l].borderWidth+"px solid "+this.config.buttons[l].borderColor,v.onclick=g.Click,v.addEventListener("touchend",function(C){return C.preventDefault(),g.Click(),!1},!1),this.mFormDiv.appendChild(v)}if(this.sigObj.isEvaluation()&&this.drawEvaluationString(x("evaluation"),i,this.canvas.width,this.canvas.height-s,t),this.reason&&this.config.reason.visible){i.fillStyle=t?this.config.reason.color:"#000000",i.font=this.config.reason.fontSize+"px "+this.config.reason.fontFace;let l=i.measureText(this.reason),g=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent;i.fillText(this.reason,this.config.reason.offsetX,g+this.config.reason.offsetY)}let r=0;const o=new Date,a=("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)+" "+o.toLocaleString("default",{day:"2-digit",month:"long",year:"numeric"});i.fillStyle=t?this.config.date.color:"#000000",i.font=this.config.date.fontSize+"px "+this.config.date.fontFace;let h=i.measureText(a),d=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent;r=this.canvas.height-s-d-this.config.date.offsetY,this.config.date.visible&&i.fillText(a,this.canvas.width-h.width-this.config.date.offsetX,r);let m=0;if(this.signatory){i.fillStyle=t?this.config.signatory.color:"#000000",i.font=this.config.signatory.fontSize+"px "+this.config.signatory.fontFace;let l=i.measureText(this.signatory),g=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent;m=r-g*2-this.config.signatory.offsetY,this.config.signatory.visible&&i.fillText(this.signatory,this.canvas.width-l.width-this.config.signatory.offsetX,r-g-this.config.signatory.offsetY)}return this.config.signingLine.width>0&&this.config.signingLine.visible&&(i.strokeStyle=t?this.config.signingLine.color:"#000000",i.lineWidth=this.config.signingLine.width,i.moveTo(this.config.signingLine.left,m-this.config.signingLine.width-this.config.signingLine.offsetY),i.lineTo(this.canvas.width-this.config.signingLine.right,m-this.config.signingLine.width-this.config.signingLine.offsetY)),i.stroke(),e.toDataURL("image/jpeg")}async clearScreen(){this.drawingPath=new Path2D,this.drawingCtx.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.height),this.capturedPoints=new Array,this.clearTimeOnSurface()}async closeWindow(){this.stopCapture(),this.mSignatureWindow.remove(),this.willEngine&&(this.willEngine.delete(),this.willEngine=null),this.mModalBackground&&this.mModalBackground.remove()}async clear(){this.btnClearClick()}async accept(){this.btnOkClick()}async cancel(){this.btnCancelClick()}async btnOkClick(){if(this.capturedPoints.length>0){let t=0;if(this.config.minTimeOnSurface&&(t=this.config.minTimeOnSurface),this.timeOnSurface>t){this.stopTimeOut(),this.showGeneratingSignatureScreen(!0);const e=this.getCaptureData();e.then(async i=>{i?(await this.close(),this.onOkListeners.forEach(n=>n())):alert("Error"),this.showGeneratingSignatureScreen(!1)}),e.catch(i=>{alert(i),this.showGeneratingSignatureScreen(!1)})}}}async btnClearClick(){await this.clearScreen(),this.onClearListeners.forEach(t=>t())}async btnCancelClick(){await this.close(),this.onCancelListeners.forEach(t=>t())}fitTextOnCanvas(t,e,i,n){let s=300,r;do s--,t.font=s+"px "+n,r=t.measureText(e);while(r.width>i.width||r.actualBoundingBoxAscent+r.actualBoundingBoxDescent>i.height);return s}onMouseEnter(t){t.preventDefault()}onMouseLeave(t){t.preventDefault()}onDown(t){if(t.preventDefault(),this.mDown==="down")return!1;let e=0,i,n;this.hasPressure=!1;let s;if(t instanceof PointerEvent){if(t.buttons!=1||(typeof t.pressure<"u"&&(t.pointerType==="pen"||t.pointerType==="stu")&&(e=t.pressure,this.hasPressure=!0),i=t.offsetX,n=t.offsetY,s=t.pointerType,this.pointerId=t.pointerId,!this.config.allowZeroPressure&&t.pointerType==="pen"&&t.pressure===0))return!1}else{const h=t.target.getBoundingClientRect();t.touches&&t.touches[0]?(typeof t.touches[0].force<"u"&&t.touches[0].force>0&&t.touches[0].force<1?(e=t.targetTouches[0].force,this.hasPressure=!0,s="pen"):s="touch",i=t.targetTouches[0].clientX-h.x,n=t.targetTouches[0].clientY-h.y,this.pointerId=t.targetTouches[0].identifier):(s="mouse",i=t.clientX-h.x,n=t.clientY-h.y,this.pointerId="mouse")}switch(s){case"mouse":if(!this.config.source.mouse)return;break;case"touch":if(!this.config.source.touch)return;break;case"pen":if(!this.config.source.pen)return;break;case"stu":if(!this.config.source.stu)return;break}this.mDown="down",this.disableScroll();let r=Math.floor(t.timeStamp);this.willEngine||(this.willEngine=new this.sigSDK.WillEngine(this.config.strokeSize,this.hasPressure)),this.willEngine.addPointerData(this.sigSDK.Phase.BEGIN,i>0?i:0,n>0?n:0,e,r),this.currentPath=new Path2D;const o=T(t);var a={type:"down",x:i>0?i:0,y:n>0?n:0,p:e,t:r,azimuth:o.azimuth,altitude:o.altitude,twist:o.twist,isDown:!0,stroke_id:this.currentStrokeID};this.capturedPoints.push(a),this.stopTimeOut(),this.startDown=Date.now(),this.drawingPoints=new Array}onMovePointer(t){if(t.preventDefault(),this.mDown===void 0||this.mDown==="up")return!1;let e;if(typeof t.getCoalescedEvents=="function"){const i=t.getCoalescedEvents();for(const n of i){if((!e||n.offsetX!=e.offsetX||n.offsetY!=e.offsetY||n.timeStamp!=e.timeStamp)&&!this.onMove(n))return!1;e=n}if((!e||event.offsetX!=e.offsetX||event.offsetY!=e.offsetY||event.timeStamp!=e.timeStamp)&&!this.onMove(event))return!1}else this.onMove(event)}onMove(t){if(t.preventDefault(),this.mDown===void 0||this.mDown==="up")return!1;let e=0,i,n;if(t instanceof PointerEvent){if(typeof t.pressure<"u"&&(t.pointerType==="pen"||t.pointerType==="stu")&&(e=t.pressure),i=t.offsetX,n=t.offsetY,this.pointerId!=="mouse"&&this.pointerId!==t.pointerId)return!1}else{const a=t.target.getBoundingClientRect();if(t.touches&&t.touches[0]){if(typeof t.touches[0].force<"u"&&t.touches[0].force>0&&(e=t.touches[0].force),i=t.targetTouches[0].clientX-a.x,n=t.targetTouches[0].clientY-a.y,this.pointerId!==t.targetTouches[0].identifier)return!1}else if(i=t.clientX-a.x,n=t.clientY-a.y,this.pointerId!=="mouse")return!1}if(i>this.drawingCanvas.width||n>this.drawingCanvas.height||i<0||n<0)return this.mDown==="down"&&(this.onUp(t),(!this.config.onOutSide||!this.config.onOutSide())&&(this.mDown="out")),!1;if(this.mDown==="out")return this.onDown(t),!1;let s=Math.floor(t.timeStamp);const r=T(t);var o={type:"move",x:i>0?i:0,y:n>0?n:0,p:e,t:s,azimuth:r.azimuth,altitude:r.altitude,twist:r.twist,isDown:!0,stroke_id:this.currentStrokeID};if(this.capturedPoints.push(o),this.willEngine){this.willEngine.addPointerData(this.sigSDK.Phase.UPDATE,i>0?i:0,n>0?n:0,e,s);const a=this.willEngine.getLastPolygon(),h=a.getPoints();if(h.size()>0)for(let d=0;d<h.size();d++){const m=h.get(d);m.pointType==this.sigSDK.PolygonPointType.MOVE?this.currentPath.moveTo(m.x,m.y):this.currentPath.lineTo(m.x,m.y)}this.currentPath.closePath(),a.delete(),this.repaintScreen()}return!0}onUp(t){if(t.preventDefault(),this.mDown===void 0||this.mDown!=="down")return!1;let e,i;if(t instanceof PointerEvent)typeof t.pressure<"u"&&(t.pointerType==="pen"||t.pointerType==="stu")&&t.pressure,e=t.offsetX,i=t.offsetY;else{const o=t.target.getBoundingClientRect();this.mDown==="out"?t.touches&&t.touches[0]?(typeof t.touches[0].force<"u"&&t.touches[0].force>0&&t.touches[0].force,e=t.targetTouches[0].clientX-o.x,i=t.targetTouches[0].clientY-o.y):(e=t.clientX-o.x,i=t.clientY-o.y):t.changedTouches&&t.changedTouches[0]?(t.changedTouches[0].force!=="undefined"&&t.changedTouches[0].force>0&&t.changedTouches[0].force,e=t.changedTouches[0].clientX-o.x,i=t.changedTouches[0].clientY-o.y):(e=t.clientX-o.x,i=t.clientY-o.y)}let n=Math.floor(t.timeStamp);const s=T(t);var r={type:"up",x:e>0?e:0,y:i>0?i:0,p:0,t:n,azimuth:s.azimuth,altitude:s.altitude,twist:s.twist,isDown:!1,stroke_id:this.currentStrokeID};if(this.capturedPoints.push(r),this.startTimeOut(),this.addTimeOnSurface(Date.now()-this.startDown),this.enableScroll(),this.willEngine){this.willEngine.addPointerData(this.sigSDK.Phase.END,e>0?e:0,i>0?i:0,0,n),this.willEngine.getLastPolygon().delete(),this.currentPath=null;const o=this.willEngine.getStroke(),a=o.getPoints();for(let h=0;h<a.size();h++){const d=a.get(h);d.pointType==this.sigSDK.PolygonPointType.MOVE?this.drawingPath.moveTo(d.x,d.y):this.drawingPath.lineTo(d.x,d.y)}this.repaintScreen(!0),o.delete()}this.mDown="up"}getCaptureData(){let t=new this.sigSDK.StrokeVector,e=new this.sigSDK.PointVector,i=0,n=!0,s=!1;for(let f=0;f<this.capturedPoints.length;f++)if(!(!this.capturedPoints[f].isDown&&!s)){s=!0,(n&&!this.capturedPoints[f].isDown||!n&&this.capturedPoints[f].isDown)&&(n=this.capturedPoints[f].isDown,t.push_back({points:e}),e.delete(),e=new this.sigSDK.PointVector,i++);var r={x:Math.floor(this.capturedPoints[f].x),y:Math.floor(this.capturedPoints[f].y),p:Math.floor(this.capturedPoints[f].p*1e3),t:this.capturedPoints[f].t,azimuth:this.capturedPoints[f].azimuth,altitude:this.capturedPoints[f].altitude,twist:this.capturedPoints[f].twist,is_down:this.capturedPoints[f].type=="down"||this.capturedPoints[f].type=="move",stroke_id:i};e.push_back(r)}const o=this.mmToPx(1e3,1e3);var a={device_max_X:this.canvas.width,device_max_Y:this.canvas.height,device_max_P:1e3,device_pixels_per_m_x:o.width,device_pixels_per_m_y:o.height,device_origin_X:0,device_origin_Y:1,device_unit_pixels:!0};const h=this.webBrowserData.os.name+" "+this.webBrowserData.os.version,d=this.webBrowserData.browser.name+" "+this.webBrowserData.browser.version,m="",l=1e3,g="";return new Promise((f,p)=>{try{const D=this.sigObj.generateSignature(this.signatory,this.reason,g,this.integrityType,this.documentHash,t,a,h,d,m,l);D.then(S=>{if(S&&this.extraData)for(const v of this.extraData)this.sigObj.setExtraData(v.name,v.value);t.delete(),e.delete(),f(S)}),D.catch(S=>{t.delete(),e.delete(),p(S)})}catch(D){t.delete(),e.delete(),p(D)}})}mmToPx(t,e){const i=document.createElement("div");i.style="width: "+t+"mm; height:"+e+"mm;",document.body.appendChild(i);const n=i.offsetWidth,s=i.offsetHeight;return document.body.removeChild(i),{width:n,height:s}}drawEvaluationString(t,e,i,n,s){t=" "+t+" ";const r=Math.sqrt(i*i+n*n);let o=300;e.font="300px verdana";let a=e.measureText(t),h=o*r/a.width;e.font=h+"px verdana",a=e.measureText(t);const d=Math.atan(n/i),m=r-(a.actualBoundingBoxAscent+a.actualBoundingBoxDescent)*Math.cos(-d);h=h*m/a.width,e.font=h+"px verdana",a=e.measureText(t),e.save(),e.fillStyle=s?"LightGray":"#000000",e.translate(i/2,n/2),e.rotate(-d),e.fillText(t,-a.width/2,(a.actualBoundingBoxAscent+a.actualBoundingBoxDescent)/2),e.restore()}startTimeOut(){this.config.timeOut&&this.config.timeOut.enabled&&this.config.timeOut.onTimeOut&&(this.stopTimeOut(),this.timeOutInterval=setInterval(this.timeOutCallback.bind(this),this.config.timeOut.time))}stopTimeOut(){this.timeOutInterval&&(clearInterval(this.timeOutInterval),this.timeOutInterval=null)}timeOutCallback(){this.timeOutInterval&&(clearInterval(this.timeOutInterval),this.timeOutInterval=null,this.config.timeOut.onTimeOut(this.timeOnSurface))}addTimeOnSurface(t){this.timeOnSurface+=t}clearTimeOnSurface(){this.timeOnSurface=0}setDraggable(){const t=this,e=document.getElementById("titleBar");e.style.cursor="move";const i=document.getElementById("signatureWindow");e.addEventListener("pointerdown",function(n){n.preventDefault(),this.initX=i.offsetLeft,this.initY=i.offsetTop,this.firstX=n.pageX,this.firstY=n.pageY,e.addEventListener("pointermove",t.dragIt,!1),window.addEventListener("pointerup",function(){e.removeEventListener("pointermove",t.dragIt,!1)},!1)},!1)}dragIt(t){const e=document.getElementById("signatureWindow");e.style.left=this.initX+t.pageX-this.firstX+"px",e.style.top=this.initY+t.pageY-this.firstY+"px"}disableScroll(){navigator.userAgent.indexOf("Firefox")!==-1&&(document.body.style.overflowY="hidden")}enableScroll(){navigator.userAgent.indexOf("Firefox")!==-1&&(document.body.style.overflowY="auto")}repaintScreen(t){(!this.requestedDrawing||t)&&(this.requestedDrawing=!0,this.drawingCtx.clearRect(0,0,this.drawingCanvas.width,this.drawingCanvas.height),this.drawingCtx.fill(this.drawingPath),this.currentPath&&this.drawingCtx.fill(this.currentPath),requestAnimationFrame(()=>this.requestedDrawing=!1))}}u=new WeakSet,I=function(t){this.onDown(t)},E=function(t){this.onDown(t)},M=function(t){this.onMove(t)},L=function(t){this.onMove(t)},B=function(t){this.onUp(t)},W=function(t){this.onUp(t)},O=function(t){this.onUp(t)},z=function(t){this.onDown(t)},A=function(t){this.onMovePointer(t)},_=function(t){this.onUp(t)},F=function(t){this.onUp(t)},Y=function(t){this.onMouseLeave(t)},U=function(t){this.onMouseEnter(t)},R=function(t){t.preventDefault()},X=function(t){this.onUp(t)},H=function(t){this.onDown(t)};class J{constructor(t,e){this.sigSDK=t,e?(this.config=e,this.config.encryption&&(this.config.encryption.sessionID||(this.config.encryption.sessionID=12648430)),this.config.sizeMode==null&&(this.config.sizeMode="stu"),this.config.strokeColor=e.strokeColor??"#0202FE",this.config.strokeSize=e.strokeSize??6,this.config.showWait=e.showWait??!0,this.config.stuDevice=e.stuDevice):this.config={showWait:!0,sizeMode:"stu",strokeColor:"#0202FE",strokeSize:6},this.mPenData=Array(),this.onClearListeners=new Array,this.onCancelListeners=new Array,this.onOkListeners=new Array}async open(t,e,i,n,s,r){if(this.sigObj=t,e?this.who=e:this.who="Customer",i?this.why=i:this.why="Confirmed",this.extraData=n,s?this.integrityType=s:this.integrityType=this.sigSDK.KeyType.None,r?this.documentHash=r:this.documentHash=new this.sigSDK.Hash(this.sigSDK.HashType.None),!this.config.stuDevice){let g=await w.WacomGSS.STU.UsbDevice.requestDevices();if(g.length>0)this.config.stuDevice=g[0];else throw"No STU devices found"}this.mTablet=new w.WacomGSS.STU.Tablet,this.mTablet.addTabletHandler(this),this.config.encryption&&(this.config.encryption.encryptionHandler&&this.mTablet.setEncryptionHandler(this.config.encryption.encryptionHandler),this.config.encryption.encryptionHandler2&&this.mTablet.setEncryptionHandler2(this.config.encryption.encryptionHandler2));try{await this.mTablet.usbConnect(this.config.stuDevice)}catch{alert("STU Device not found")}this.mCapability=await this.mTablet.getCapability(),this.mInformation=await this.mTablet.getInformation(),this.mInkThreshold=await this.mTablet.getInkThreshold();try{this.uid=await this.mTablet.getUid()}catch{this.uid=0}try{this.uid2=await this.mTablet.getUid2()}catch{this.uid2=0}try{await this.mTablet.setPenDataOptionMode(w.WacomGSS.STU.Protocol.PenDataOptionMode.TimeCountSequence)}catch{}let o=0,a=0;if(this.config.sizeMode=="fixed"&&this.config.width&&this.config.height)o=parseInt(this.config.width),a=parseInt(this.config.height);else if(this.config.attachTo){const g=$("#"+this.config.attachTo).width(),c=$("#"+this.config.attachTo).height(),f=96*this.mCapability.tabletMaxX*.01/25.4,p=96*this.mCapability.tabletMaxY*.01/25.4;this.config.sizeMode=="fit"?(o=g,a=c):this.config.sizeMode=="strech"?f>p?(o=g,a=p/f*o):(a=c,o=f/p*a):(o=f,a=p)}else o=96*this.mCapability.tabletMaxX*.01/25.4,a=96*this.mCapability.tabletMaxY*.01/25.4;this.mScaleX=o/this.mCapability.tabletMaxX,this.mScaleY=a/this.mCapability.tabletMaxY;let h=!0,d=w.WacomGSS.STU.Protocol.ProtocolHelper.simulateEncodingFlag(this.mTablet.getProductId(),this.mCapability.ecodingFlag);d&w.WacomGSS.STU.Protocol.EncodingFlag.EncodingFlag_24bit?this.mEncodingMode=this.mTablet.supportsWrite()?w.WacomGSS.STU.Protocol.EncodingMode.EncodingMode_24bit_Bulk:w.WacomGSS.STU.Protocol.EncodingMode.EncodingMode_24bit:d&w.WacomGSS.STU.Protocol.EncodingFlag.EncodingFlag_16bit?this.mEncodingMode=this.mTablet.supportsWrite()?w.WacomGSS.STU.Protocol.EncodingMode.EncodingMode_16bit_Bulk:w.WacomGSS.STU.Protocol.EncodingMode.EncodingMode_16bit:(this.mEncodingMode=w.WacomGSS.STU.Protocol.EncodingMode.EncodingMode_1bit,h=!1),this.config.width=o,this.config.height=a,this.config.title=this.mInformation.modelName,this.config.source={mouse:!1,touch:!1,pen:!1,stu:!0},this.sigCaptDialog=new j(this.sigSDK,this.config),this.sigCaptDialog.getCaptureData=this.getCaptureData.bind(this),this.sigCaptDialog.addEventListener("clear",this.onClearBtn.bind(this)),this.sigCaptDialog.addEventListener("cancel",this.onCancelBtn.bind(this)),this.sigCaptDialog.addEventListener("ok",this.onOkBtn.bind(this)),await this.sigCaptDialog.open(this.sigObj,this.who,this.why,this.extraData,this.integrityType,this.documentHash);let m=await this.drawImageToCanvas(this.sigCaptDialog.createScreenImage(h));if(m.getContext("2d"),this.mDeviceBackgroundImage=w.WacomGSS.STU.Protocol.ProtocolHelper.resizeAndFlatten(m,0,0,o,a,this.mCapability.screenWidth,this.mCapability.screenHeight,this.mEncodingMode,w.WacomGSS.STU.Protocol.ProtocolHelper.Scale.Stretch,"white",!1,!1),this.config.encryption&&(this.mTablet.isSupported(w.WacomGSS.STU.Protocol.ReportId.EncryptionStatus)||await w.WacomGSS.STU.Protocol.ProtocolHelper.supportsEncryption(this.mTablet.getProtocol()))&&(await this.mTablet.startCapture(this.config.encryption.sessionID),this.mIsEncrypted=!0),h){let g=await this.mTablet.getHandwritingThicknessColor(),c=this.hexToRgb(this.config.strokeColor);g.penColor=this.rgb3216(c.r,c.g,c.b),g.penThickness=this.config.strokeSize,await this.mTablet.setHandwritingThicknessColor(g)}this.mTablet.getReportCountLengths()[w.WacomGSS.STU.Protocol.ReportId.RenderingMode_$LI$()]!==void 0&&await this.mTablet.setRenderingMode(w.WacomGSS.STU.Protocol.RenderingMode.WILL),await this.mTablet.setInkingMode(w.WacomGSS.STU.Protocol.InkingMode.On),await this.clearScreen()}rgb3216(t,e,i){return(t&248)<<8|(e&252)<<3|(i&248)>>3}hexToRgb(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}addEventListener(t,e){switch(t){case"clear":this.onClearListeners.push(e);break;case"cancel":this.onCancelListeners.push(e);break;case"ok":this.onOkListeners.push(e);break}}async drawWait(){const t=document.createElement("canvas");t.width=this.mCapability.screenWidth,t.height=this.mCapability.screenHeight;const e=t.getContext("2d");e.font="60pt Wingdings";const i="6",n=e.measureText(i),s=n.width,r=n.fontBoundingBoxAscent+n.fontBoundingBoxDescent,o=Math.max(s,r),a=3;t.width=o,t.height=o,e.fillStyle="white",e.fillRect(0,0,t.width,t.height),e.fillStyle="black",e.font="60pt Wingdings",e.fillText(i,s/2-a,(r+n.fontBoundingBoxAscent)/2-a),e.strokeStyle="black",e.lineWidth=a,e.beginPath(),e.arc(o/2,o/2,(o-a*2)/2,0,2*Math.PI),e.stroke();const h=Math.floor(this.mCapability.screenWidth/2-o/2),d=Math.floor(this.mCapability.screenHeight/2-o/2),m=w.WacomGSS.STU.Protocol.ProtocolHelper.resizeAndFlatten(t,0,0,t.width,t.height,t.width,t.height,this.mEncodingMode,0,"white",!1,!1),l=new w.WacomGSS.STU.Protocol.Rectangle(h,d,h+t.width-1,d+t.height-1);await this.mTablet.writeImageArea(this.mEncodingMode,l,m)}async clearScreen(){this.sigCaptDialog.stopCapture(),await this.mTablet.setClearScreen(),this.config.showWait&&this.mTablet.isSupported(w.WacomGSS.STU.Protocol.ReportId.StartImageDataArea_$LI$())&&await this.drawWait(),await this.mTablet.writeImage(this.mEncodingMode,this.mDeviceBackgroundImage),this.sigCaptDialog.startCapture()}async disconnect(){this.mTablet!=null&&(this.mIsEncrypted&&(await this.mTablet.endCapture(),this.mIsEncrypted=!1),await this.mTablet.setInkingMode(w.WacomGSS.STU.Protocol.InkingMode.Off),await this.mTablet.setClearScreen(),await this.mTablet.disconnect())}tabletToScreen(t){return{x:t.x*this.mScaleX,y:t.y*this.mScaleY}}clear(){this.sigCaptDialog&&this.sigCaptDialog.clear()}cancel(){this.sigCaptDialog&&this.sigCaptDialog.cancel()}accept(){this.sigCaptDialog&&this.sigCaptDialog.accept()}onClearBtn(){this.mPenData.length>0&&(this.mPenData=new Array,this.clearScreen()),this.sigCaptDialog.clearTimeOnSurface()}onCancelBtn(){this.disconnect()}async onOkBtn(){await this.disconnect(),this.onOkListeners.forEach(t=>t())}onPenDataOption(t,e){this.onPenData(t,e)}onPenDataTimeCountSequence(t,e){this.onPenData(t,e)}onPenDataTimeCountSequenceEncrypted(t,e){this.onPenDataTimeCountSequence(t,e)}onPenDataEncryptedOption(t,e){this.onPenData(t.penData1,e),this.onPenData(t.penData2,e)}onPenDataEncrypted(t,e){this.onPenData(t.penData1,e),this.onPenData(t.penData2,e)}onPenData(t,e){t.timeCount||(t.timeCount=Math.trunc(e)%1e6);const i=this.tabletToScreen(t),n=this.sigCaptDialog.getButton(i),s=t.pressure>this.mInkThreshold.onPressureMark;if(this.mIsDown)if(s){if(this.mBtnIndex==-1){var a=new PointerEvent("pointermove",{pointerId:1,pointerType:"stu",isPrimary:!0,clientX:i.x,clientY:i.y,pressure:t.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onMove(a),this.mPenData.push(t)}}else if(this.mBtnIndex>-1)n==this.mBtnIndex&&this.sigCaptDialog.clickButton(this.mBtnIndex);else{var o=new PointerEvent("pointerup",{pointerId:1,pointerType:"stu",isPrimary:!0,clientX:i.x,clientY:i.y,pressure:t.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onUp(o),this.mPenData.push(t)}else if(s){if(this.mBtnIndex=n,this.mBtnIndex==-1){this.mPenData.push(t);var r=new PointerEvent("pointerdown",{pointerId:1,pointerType:"stu",isPrimary:!0,clientX:i.x,clientY:i.y,pressure:t.pressure/this.mCapability.tabletMaxPressure,buttons:1});this.sigCaptDialog.onDown(r)}}else this.mPenData.push(t);this.mIsDown=s}getCaptureData(){let t=new this.sigSDK.StrokeVector,e=new this.sigSDK.PointVector,i=0,n=!0,s=!1;for(let p=0;p<this.mPenData.length;p++)if(!(this.mPenData[p].sw==0&&!s)){s=!0,(n&&this.mPenData[p].sw==0||!n&&this.mPenData[p].sw==1)&&(n=this.mPenData[p].sw==1,t.push_back({points:e}),e.delete(),e=new this.sigSDK.PointVector,i++);var r={x:this.mPenData[p].x,y:this.mPenData[p].y,p:this.mPenData[p].pressure,t:this.mPenData[p].timeCount,azimuth:0,altitude:0,twist:0,is_down:this.mPenData[p].sw,stroke_id:i};e.push_back(r)}var o={device_max_X:this.mCapability.tabletMaxX,device_max_Y:this.mCapability.tabletMaxY,device_max_P:this.mCapability.tabletMaxPressure,device_pixels_per_m_x:1e5,device_pixels_per_m_y:1e5,device_origin_X:0,device_origin_Y:1,device_unit_pixels:!1};const a=this.sigCaptDialog.webBrowserData.os.name+" "+this.sigCaptDialog.webBrowserData.os.version,h="STU;'"+this.mInformation.modelName+"';"+this.mInformation.firmwareMajorVersion+"."+(parseInt(this.mInformation.firmwareMinorVersion)>>4&15)+"."+(parseInt(this.mInformation.firmwareMinorVersion)&15)+";"+this.uid+";"+this.uid2,d="",m=1e3,l=this.who,g=this.why,c="";return new Promise((p,D)=>{try{const S=this.sigObj.generateSignature(l,g,c,this.integrityType,this.documentHash,t,o,a,h,d,m);S.then(v=>{if(v&&this.extraData)for(const C of this.extraData)this.sigObj.setExtraData(C.name,C.value);t.delete(),e.delete(),p(v)}),S.catch(v=>{t.delete(),e.delete(),D(v)})}catch(S){t.delete(),e.delete(),D(S)}})}drawImageToCanvas(t){return new Promise((e,i)=>{let n=new Image;n.onload=()=>{let s=document.createElement("canvas");s.height=n.height,s.width=n.width,s.getContext("2d").drawImage(n,0,0),e(s)},n.onerror=i,n.src=t})}}export{j as S,J as a};
